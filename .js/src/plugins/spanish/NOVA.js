var t,e=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(e,r);a&&!("get"in a?!e.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,a)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),n=this&&this.__importStar||(t=function(e){return t=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e},t(e)},function(n){if(n&&n.__esModule)return n;var a={};if(null!=n)for(var i=t(n),o=0;o<i.length;o++)"default"!==i[o]&&e(a,n,i[o]);return r(a,n),a}),a=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function o(t){try{s(n.next(t))}catch(t){i(t)}}function c(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,c)}s((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=c(0),o.throw=c(1),o.return=c(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&c[0]?n.return:c[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,c[1])).done)return a;switch(n=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(t){c=[6,t],n=0}finally{r=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var o=require("@libs/fetch"),c=require("@libs/novelStatus"),s=n(require("cheerio")),u=function(){function t(){this.id="nova",this.name="NOVA",this.icon="src/en/kdtnovels/icon.png",this.site="https://novelasligeras.net",this.version="1.1.0",this.CHAPTER_REGEX=/(Parte \d+) . (.+?): (.+)/}return t.prototype.bypassCloudflareImages=function(t,e){return a(this,void 0,void 0,(function(){return i(this,(function(r){return e.find("img").each((function(e,r){var n=t(r),a=n.attr("src")||n.attr("data-src")||n.attr("data-cfsrc");a&&(n.attr("src",a),n.removeAttr("data-src"),n.removeAttr("data-cfsrc"))})),[2,e.html()||""]}))}))},t.prototype.htmlToText=function(t){if(!t)return"";var e=s.load(t);return e("script, style").remove(),e.text().trim()},t.prototype.popularNovels=function(t,e){return a(this,void 0,void 0,(function(){var e,r,n,a,c=this;return i(this,(function(i){switch(i.label){case 0:return 1===t?[2,this.searchNovels("",1)]:(e="".concat(this.site,"/index.php/page/").concat(t,"/?post_type=product&orderby=popularity"),[4,(0,o.fetchApi)(e).then((function(t){return t.text()}))]);case 1:return r=i.sent(),n=s.load(r),a=[],n(".dt-css-grid div.wf-cell").each((function(t,e){var r,i=n(e),o=i.find("img"),s=i.find("h4.entry-title a"),u=(null===(r=s.attr("href"))||void 0===r?void 0:r.replace(c.site,""))||"",l=s.text().trim(),p=o.attr("data-src")||o.attr("data-cfsrc")||o.attr("src")||"";l&&u&&a.push({name:l,path:u,cover:p})})),[2,a]}}))}))},t.prototype.searchNovels=function(t,e){return a(this,void 0,void 0,(function(){var r,n,a,c,u,l,p,d=this;return i(this,(function(i){switch(i.label){case 0:return r=[],e>1?(n=encodeURIComponent(t),u="".concat(this.site,"/index.php/page/").concat(e,"/?s=").concat(n,"&post_type=product&title=1&excerpt=1&content=0&categories=1&attributes=1&tags=1&sku=0&orderby=popularity&ixwps=1"),[4,(0,o.fetchApi)(u).then((function(t){return t.text()}))]):[3,2];case 1:return a=i.sent(),(c=s.load(a))(".dt-css-grid div.wf-cell").each((function(t,e){var n,a=c(e),i=a.find("img"),o=a.find("h4.entry-title a"),s=(null===(n=o.attr("href"))||void 0===n?void 0:n.replace(d.site,""))||"",u=o.text().trim(),l=i.attr("data-src")||i.attr("data-cfsrc")||i.attr("src")||"";u&&s&&r.push({name:u,path:s,cover:l})})),[3,5];case 2:return u="".concat(this.site,"/wp-admin/admin-ajax.php?tags=1&sku=&limit=30&category_results=&order=DESC&category_limit=5&order_by=title&product_thumbnails=1&title=1&excerpt=1&content=&categories=1&attributes=1"),(l=new FormData).append("action","product_search"),l.append("product-search","1"),l.append("product-query",t),[4,(0,o.fetchApi)(u,{method:"POST",body:l})];case 3:return[4,i.sent().json()];case 4:p=i.sent(),Array.isArray(p)&&p.forEach((function(t){var e,n=(null===(e=t.url)||void 0===e?void 0:e.replace(d.site,""))||"",a=t.title||"",i=t.thumbnail||"";a&&n&&r.push({name:a,path:n,cover:i})})),i.label=5;case 5:return[2,r]}}))}))},t.prototype.parseNovel=function(t){return a(this,void 0,void 0,(function(){var e,r,n,a,u,l,p,d,h,f,v,m,b,y,_=this;return i(this,(function(i){switch(i.label){case 0:return e="".concat(this.site).concat(t),[4,(0,o.fetchApi)(e).then((function(t){return t.text()}))];case 1:return r=i.sent(),n=s.load(r),a=n("h1").first().text().trim(),u=n(".woocommerce-product-gallery").find("img").first(),l=u.attr("src")||u.attr("data-cfsrc")||u.attr("data-src")||"",p=n(".woocommerce-product-attributes-item--attribute_pa_escritor td").text().trim()||"Desconocido",d=n(".woocommerce-product-attributes-item--attribute_pa_ilustrador td").text().trim()||"",h=n(".woocommerce-product-details__short-description").html(),f=this.htmlToText(h),v=n(".woocommerce-product-attributes-item--attribute_pa_estado td").text().trim().toLowerCase(),m=c.NovelStatus.Unknown,v.includes("en curso")||v.includes("ongoing")?m=c.NovelStatus.Ongoing:(v.includes("completado")||v.includes("completed"))&&(m=c.NovelStatus.Completed),b=[],y=0,n(".vc_row div.vc_column-inner > div.wpb_wrapper").each((function(t,e){var r=n(e),a=r.find(".dt-fancy-title").first().text().trim();a.startsWith("Volumen")&&r.find(".wpb_tab a").each((function(t,e){var r,i=n(e),o=i.text().trim(),c=(null===(r=i.attr("href"))||void 0===r?void 0:r.replace(_.site,""))||"";if(c){var s,u=_.CHAPTER_REGEX.exec(o);if(u){var l=u[1],p=u[2],d=u[3];s="".concat(a," - ").concat(p," - ").concat(l,": ").concat(d)}else s="".concat(a," - ").concat(o);b.push({name:s,path:c,releaseTime:"",chapterNumber:y+1}),y++}}))})),[2,{path:t,name:a,cover:l,summary:f,author:p,artist:d,status:m,chapters:b}]}}))}))},t.prototype.parseChapter=function(t){return a(this,void 0,void 0,(function(){var e,r,n,a,c,u;return i(this,(function(i){switch(i.label){case 0:return e="".concat(this.site).concat(t),[4,(0,o.fetchApi)(e).then((function(t){return t.text()}))];case 1:return r=i.sent(),n=s.load(r),(a=r.includes("Nadie entra sin permiso en la Gran Tumba de Nazarick")?n("#content"):n(".wpb_text_column.wpb_content_element > .wpb_wrapper")).find("center").remove(),a.find("*").each((function(t,e){var r=n(e),a=r.attr("style")||"";/text-align:.?center/.test(a)&&r.replaceWith("<center>".concat(r.html(),"</center>"))})),[4,this.bypassCloudflareImages(n,a)];case 2:return c=i.sent(),(u=s.load(c))("script, style, iframe, .ads, .advertisement").remove(),[2,u.html()||c]}}))}))},t}();exports.default=new u;